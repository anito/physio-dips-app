import{r as t,c as s,h as i}from"./p-7d485867.js";import{P as e}from"./p-d8000c6e.js";import{a as h,b as a,h as n,d as o,j as r}from"./p-eef3d203.js";import{c}from"./p-59c69388.js";import"./p-e9fb6631.js";import"./p-29d1ed0b.js";import{V as d}from"./p-415151d7.js";import{w as u}from"./p-38491ace.js";import"./p-bd8dee20.js";import"./p-0d34702b.js";import{b as m,a as p}from"./p-64e9395d.js";import{M as l}from"./p-8b74fa0e.js";var b,g;!function(t){t.Play="playVideo",t.Pause="pauseVideo",t.Seek="seekTo",t.Mute="mute",t.Unmute="unMute",t.SetVolume="setVolume",t.SetPlaybackRate="setPlaybackRate"}(b||(b={})),function(t){t.Unknown="unknown",t.Tiny="tiny",t.Small="small",t.Medium="medium",t.Large="large",t.Hd720="hd720",t.Hd1080="hd1080",t.Highres="highres",t.Max="max"}(g||(g={}));const y=t=>{switch(t){case g.Unknown:return;case g.Tiny:return"144p";case g.Small:return"240p";case g.Medium:return"360p";case g.Large:return"480p";case g.Hd720:return"720p";case g.Hd1080:return"1080p";case g.Highres:return"1440p";case g.Max:return"2160p";default:return}};var f;!function(t){t[t.Unstarted=-1]="Unstarted",t[t.Ended=0]="Ended",t[t.Playing=1]="Playing",t[t.Paused=2]="Paused",t[t.Buffering=3]="Buffering",t[t.Cued=5]="Cued"}(f||(f={}));const w=class{constructor(i){t(this,i),this.vLoadStart=s(this,"vLoadStart",7),this.defaultInternalState={},this.internalState={paused:!0,duration:0,seeking:!1,playbackStarted:!1,currentTime:0,lastTimeUpdate:0,playbackRate:1,state:-1},this.embedSrc="",this.mediaTitle="",this.cookies=!1,this.showFullscreenControl=!0,this.language="en",this.autoplay=!1,this.controls=!1,this.debug=!1,this.loop=!1,this.muted=!1,this.playsinline=!1}onVideoIdChange(){this.embedSrc=`${this.getOrigin()}/embed/${this.videoId}`,this.pendingPosterFetch=this.findPosterURL()}componentWillLoad(){this.dispatch=c(this),this.dispatch(e.ViewType,d.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.defaultInternalState=Object.assign({},this.internalState)}disconnectedCallback(){this.pendingPosterFetch=void 0}async getAdapter(){const t=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl(b.Play)},pause:async()=>{this.remoteControl(b.Pause)},canPlay:async s=>h(s)&&t.test(s),setCurrentTime:async t=>{this.remoteControl(b.Seek,t)},setMuted:async t=>{this.remoteControl(t?b.Mute:b.Unmute)},setVolume:async t=>{this.remoteControl(b.SetVolume,t)},canSetPlaybackRate:async()=>!0,setPlaybackRate:async t=>{this.remoteControl(b.SetPlaybackRate,t)}}}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}getPreconnections(){return[this.getOrigin(),"https://www.google.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net","https://s.ytimg.com","https://i.ytimg.com"]}remoteControl(t,s){return this.embed.postMessage({event:"command",func:t,args:s?[s]:void 0})}buildParams(){return{enablejsapi:1,cc_lang_pref:this.language,hl:this.language,widget_referrer:window.location.href,fs:this.showFullscreenControl?1:0,controls:this.controls?1:0,disablekb:this.controls?0:1,iv_load_policy:this.controls?1:3,mute:this.initialMuted?1:0,playsinline:this.playsinline?1:0,autoplay:this.autoplay?1:0}}onEmbedSrcChange(){this.vLoadStart.emit()}onEmbedLoaded(){window.setTimeout(()=>this.embed.postMessage({event:"listening"}),100)}findPosterURL(){const t=t=>`https://i.ytimg.com/vi/${this.videoId}/${t}.jpg`;return m(t("maxresdefault"),121).catch(()=>m(t("sddefault"),121)).catch(()=>m(t("hqdefault"),121)).then(t=>{this.dispatch(e.CurrentPoster,t.src)})}onPlayerStateChange(t){if(t===f.Unstarted)return;const s=t===f.Playing,i=t===f.Buffering;switch(this.dispatch(e.Buffering,i),this.internalState.paused&&(i||s)&&(this.internalState.paused=!1,this.dispatch(e.Paused,!1),this.internalState.playbackStarted||(this.dispatch(e.PlaybackStarted,!0),this.internalState.playbackStarted=!0)),t){case f.Cued:this.internalState=Object.assign({},this.defaultInternalState),this.dispatch(e.CurrentSrc,this.embedSrc),this.dispatch(e.MediaType,l.Video),this.pendingPosterFetch.then(()=>{this.dispatch(e.PlaybackReady,!0),this.pendingPosterFetch=void 0});break;case f.Playing:this.dispatch(e.Playing,!0);break;case f.Paused:this.internalState.paused=!0,this.dispatch(e.Paused,!0);break;case f.Ended:this.loop?window.setTimeout(()=>{this.remoteControl(b.Play)},150):this.dispatch(e.PlaybackEnded,!0)}this.internalState.state=t}calcCurrentTime(t){let s=t;if(this.internalState.state===f.Playing){const t=(Date.now()/1e3-this.defaultInternalState.lastTimeUpdate)*this.internalState.playbackRate;t>0&&(s+=Math.min(t,1))}return s}onTimeChange(t){const s=this.calcCurrentTime(t);this.dispatch(e.CurrentTime,s),Math.abs(this.internalState.currentTime-s)>1.5&&(this.internalState.seeking=!0,this.dispatch(e.Seeking,!0)),this.internalState.currentTime=s}onBufferedChange(t){this.dispatch(e.Buffered,t),this.internalState.seeking&&t>this.internalState.currentTime&&window.setTimeout(()=>{this.internalState.seeking=!1,this.dispatch(e.Seeking,!1)},this.internalState.paused?100:0)}onEmbedMessage(t){const s=t.detail,{info:i}=s;i&&(a(i.videoData)&&this.dispatch(e.MediaTitle,i.videoData.title),n(i.duration)&&(this.internalState.duration=i.duration,this.dispatch(e.Duration,i.duration)),o(i.availablePlaybackRates)&&this.dispatch(e.PlaybackRates,i.availablePlaybackRates),n(i.playbackRate)&&(this.internalState.playbackRate=i.playbackRate,this.dispatch(e.PlaybackRate,i.playbackRate)),n(i.currentTime)&&this.onTimeChange(i.currentTime),n(i.currentTimeLastUpdated)&&(this.internalState.lastTimeUpdate=i.currentTimeLastUpdated),n(i.videoLoadedFraction)&&this.onBufferedChange(i.videoLoadedFraction*this.internalState.duration),n(i.volume)&&this.dispatch(e.Volume,i.volume),r(i.muted)&&this.dispatch(e.Muted,i.muted),o(i.availableQualityLevels)&&this.dispatch(e.PlaybackQualities,i.availableQualityLevels.map(t=>y(t))),h(i.playbackQuality)&&this.dispatch(e.PlaybackQuality,y(i.playbackQuality)),n(i.playerState)&&this.onPlayerStateChange(i.playerState))}render(){return i("vime-embed",{embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:p,preconnections:this.getPreconnections(),onVEmbedLoaded:this.onEmbedLoaded.bind(this),onVEmbedMessage:this.onEmbedMessage.bind(this),onVEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{cookies:["onVideoIdChange"],videoId:["onVideoIdChange"]}}};u(w);export{w as vime_youtube}