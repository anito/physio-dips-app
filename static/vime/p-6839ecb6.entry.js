import{r as t,c as i,h as s,g as e}from"./p-6a8a5b8e.js";import{P as h}from"./p-7e342812.js";import{a as n,g as o,h as a,d as r,b as l}from"./p-d22fa63b.js";import{c as d}from"./p-1f4b6ee8.js";import{f as c}from"./p-0d94bd6e.js";import"./p-d8b735e7.js";import{l as u}from"./p-bd8dee20.js";import{V as p}from"./p-415151d7.js";import{M as v}from"./p-8b74fa0e.js";import{e as m,f as g,g as P,h as y}from"./p-cab62385.js";import{a as b,v as f,h as w}from"./p-b0ea4d0d.js";import{w as C}from"./p-e3411fb0.js";import{D as S}from"./p-874fa941.js";var j;!function(t){t.PiP="picture-in-picture",t.Inline="inline",t.Fullscreen="fullscreen"}(j||(j={}));const T=class{constructor(s){t(this,s),this.vLoadStart=i(this,"vLoadStart",7),this.vSrcSetChange=i(this,"vSrcSetChange",7),this.disposal=new S,this.playbackStarted=!1,this.wasPausedBeforeSeeking=!0,this.currentSrcSet=[],this.willAttach=!1,this.preload="metadata",this.playbackRates=[.25,.5,.75,1,1.25,1.5,2],this.language="en",this.autoplay=!1,this.controls=!1,this.debug=!1,this.loop=!1,this.muted=!1,this.playsinline=!1}onMediaTitleChange(){this.dispatch(h.mediaTitle,this.mediaTitle)}onPosterChange(){this.dispatch(h.currentPoster,this.poster)}onViewTypeChange(){this.dispatch(h.viewType,this.viewType)}componentWillLoad(){this.dispatch=d(this),this.onViewTypeChange(),this.onPosterChange(),this.onMediaTitleChange(),this.listenToTextTracksChanges()}componentDidLoad(){this.onViewTypeChange()}disconnectedCallback(){var t;this.mediaEl.pause(),this.cancelTimeUpdates(),this.disposal.empty(),null===(t=this.cancelMutationObserver)||void 0===t||t.call(this),this.playbackStarted=!1,this.wasPausedBeforeSeeking=!0}setupMutationObserver(){var t;if(null===(t=this.cancelMutationObserver)||void 0===t||t.call(this),n(this.mediaEl))return;const i=new MutationObserver(this.didSrcSetChange.bind(this));i.observe(this.mediaEl,{childList:!0,subtree:!0,attributeFilter:["src","data-src"]}),this.cancelMutationObserver=()=>{i.disconnect()}}didSrcSetChange(){var t;if(n(this.mediaEl))return;const i=Array.from(this.mediaEl.querySelectorAll("source")),s=i.map(t=>t.src||t.getAttribute("data-src"));(this.currentSrcSet.length!==s.length||s.some((t,i)=>this.currentSrcSet[i]!==t))&&(this.mediaEl.hasAttribute("data-loaded")&&i.forEach(t=>{t.hasAttribute("data-src")&&!t.hasAttribute("src")&&t.setAttribute("src",t.getAttribute("data-src"))}),this.vLoadStart.emit(),null===(t=this.mediaEl)||void 0===t||t.load(),this.vSrcSetChange.emit()),this.currentSrcSet=s}hasCustomPoster(){const t=c(this);return!o(t.querySelector("vime-ui vime-poster"))}cancelTimeUpdates(){a(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF),this.timeRAF=void 0}requestTimeUpdates(){var t,i;this.dispatch(h.currentTime,null!==(i=null===(t=this.mediaEl)||void 0===t?void 0:t.currentTime)&&void 0!==i?i:0),this.timeRAF=window.requestAnimationFrame(()=>{this.requestTimeUpdates()})}getMediaType(){const{currentSrc:t}=this.mediaEl;return b.test(t)?v.Audio:f.test(t)||w.test(t)?v.Video:void 0}onLoadedMetadata(){this.dispatch(h.currentPoster,this.poster),this.dispatch(h.duration,this.mediaEl.duration),this.dispatch(h.playbackRates,this.playbackRates),this.onProgress(),this.onTracksChange(),this.didSrcSetChange(),this.willAttach||(this.dispatch(h.currentSrc,this.mediaEl.currentSrc),this.dispatch(h.mediaType,this.getMediaType()),this.dispatch(h.playbackReady,!0))}onProgress(){const{buffered:t,duration:i}=this.mediaEl,s=0===t.length?0:t.end(t.length-1);this.dispatch(h.buffered,s>i?i:s)}onPlay(){this.requestTimeUpdates(),this.dispatch(h.paused,!1),this.playbackStarted||(this.playbackStarted=!0,this.dispatch(h.playbackStarted,!0))}onPause(){this.cancelTimeUpdates(),this.dispatch(h.paused,!0),this.dispatch(h.buffering,!1)}onPlaying(){this.dispatch(h.playing,!0),this.dispatch(h.buffering,!1)}onSeeking(){this.wasPausedBeforeSeeking||(this.wasPausedBeforeSeeking=this.mediaEl.paused),this.dispatch(h.currentTime,this.mediaEl.currentTime),this.dispatch(h.seeking,!0)}onSeeked(){this.dispatch(h.seeking,!1),this.playbackStarted&&this.wasPausedBeforeSeeking||this.attemptToPlay(),this.wasPausedBeforeSeeking=!0}onRateChange(){this.dispatch(h.playbackRate,this.mediaEl.playbackRate)}onVolumeChange(){this.dispatch(h.muted,this.mediaEl.muted),this.dispatch(h.volume,100*this.mediaEl.volume)}onDurationChange(){this.dispatch(h.duration,this.mediaEl.duration)}onWaiting(){this.dispatch(h.buffering,!0)}onSuspend(){this.dispatch(h.buffering,!1)}onEnded(){this.loop||this.dispatch(h.playbackEnded,!0)}onError(t){this.dispatch(h.errors,[t])}attemptToPlay(){var t;try{null===(t=this.mediaEl)||void 0===t||t.play()}catch(t){this.dispatch(h.errors,[t])}}togglePiPInChrome(t){var i;return t?null===(i=this.mediaEl)||void 0===i?void 0:i.requestPictureInPicture():document.exitPictureInPicture()}togglePiPInSafari(t){var i,s;const e=t?j.PiP:j.Inline;if(!(null===(i=this.mediaEl)||void 0===i?void 0:i.webkitSupportsPresentationMode(e)))throw new Error("PiP API is not available.");return null===(s=this.mediaEl)||void 0===s?void 0:s.webkitSetPresentationMode(e)}async togglePiP(t){if(m())return this.togglePiPInChrome(t);if(g())return this.togglePiPInSafari(t);throw new Error("PiP API is not available.")}async toggleFullscreen(t){var i,s,e;if(!(null===(i=this.mediaEl)||void 0===i?void 0:i.webkitSupportsFullscreen))throw new Error("Fullscreen API is not available.");return t?null===(s=this.mediaEl)||void 0===s?void 0:s.webkitEnterFullscreen():null===(e=this.mediaEl)||void 0===e?void 0:e.webkitExitFullscreen()}onPresentationModeChange(){var t;const i=null===(t=this.mediaEl)||void 0===t?void 0:t.webkitPresentationMode;this.dispatch(h.isPiPActive,i===j.PiP),this.dispatch(h.isFullscreenActive,i===j.Fullscreen)}onEnterPiP(){this.dispatch(h.isPiPActive,!0)}onLeavePiP(){this.dispatch(h.isPiPActive,!1)}onTracksChange(){this.dispatch(h.textTracks,this.mediaEl.textTracks)}listenToTextTracksChanges(){r(this.mediaEl)||this.disposal.add(u(this.mediaEl.textTracks,"change",this.onTracksChange.bind(this)))}async getAdapter(){return{getInternalPlayer:async()=>this.mediaEl,play:async()=>{var t;return null===(t=this.mediaEl)||void 0===t?void 0:t.play()},pause:async()=>{var t;return null===(t=this.mediaEl)||void 0===t?void 0:t.pause()},canPlay:async t=>l(t)&&(b.test(t)||f.test(t)),setCurrentTime:async t=>{this.mediaEl&&(this.mediaEl.currentTime=t)},setMuted:async t=>{this.mediaEl&&(this.mediaEl.muted=t)},setVolume:async t=>{this.mediaEl&&(this.mediaEl.volume=t/100)},canSetPlaybackRate:async()=>!0,setPlaybackRate:async t=>{this.mediaEl&&(this.mediaEl.playbackRate=t)},canSetPiP:async()=>P(),enterPiP:()=>this.togglePiP(!0),exitPiP:()=>this.togglePiP(!1),canSetFullscreen:async()=>y(),enterFullscreen:()=>this.toggleFullscreen(!0),exitFullscreen:()=>this.toggleFullscreen(!1)}}render(){const t={autoplay:this.autoplay,muted:this.muted,playsinline:this.playsinline,playsInline:this.playsinline,"x5-playsinline":this.playsinline,"webkit-playsinline":this.playsinline,controls:this.controls,crossorigin:this.crossOrigin,controlslist:this.controlsList,"data-poster":this.hasCustomPoster()?void 0:this.poster,loop:this.loop,preload:this.preload,disablePictureInPicture:this.disablePiP,autoPictureInPicture:this.autoPiP,disableRemotePlayback:this.disableRemotePlayback,"x-webkit-airplay":this.disableRemotePlayback?"deny":"allow",ref:t=>{this.mediaEl=t},onLoadedMetadata:this.onLoadedMetadata.bind(this),onProgress:this.onProgress.bind(this),onPlay:this.onPlay.bind(this),onPause:this.onPause.bind(this),onPlaying:this.onPlaying.bind(this),onSeeking:this.onSeeking.bind(this),onSeeked:this.onSeeked.bind(this),onRateChange:this.onRateChange.bind(this),onVolumeChange:this.onVolumeChange.bind(this),onDurationChange:this.onDurationChange.bind(this),onWaiting:this.onWaiting.bind(this),onSuspend:this.onSuspend.bind(this),onEnded:this.onEnded.bind(this),onError:this.onError.bind(this)},i=s("audio",Object.assign({class:"lazy"},t),s("slot",null),"Your browser does not support the",s("code",null,"audio"),"element."),e=s("video",Object.assign({class:"lazy"},t,{onwebkitpresentationmodechanged:this.onPresentationModeChange.bind(this),onenterpictureinpicture:this.onEnterPiP.bind(this),onleavepictureinpicture:this.onLeavePiP.bind(this)}),s("slot",null),"Your browser does not support the",s("code",null,"video"),"element.");return this.viewType===p.Audio?i:e}get el(){return e(this)}static get watchers(){return{mediaTitle:["onMediaTitleChange"],poster:["onPosterChange"],viewType:["onViewTypeChange"],mediaEl:["setupMutationObserver"]}}};C(T),T.style="vime-file audio,vime-file video{border-radius:inherit;vertical-align:middle;width:100%;outline:0}vime-file video{position:absolute;top:0;left:0;border:0;height:100%;user-select:none}";export{T as vime_file}