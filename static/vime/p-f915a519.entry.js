import{r as t,c as i,h as s}from"./p-7d485867.js";import{P as e}from"./p-d8000c6e.js";import{g as h,h as n,e as o,a}from"./p-eef3d203.js";import{c as r}from"./p-59c69388.js";import{f as l}from"./p-e9fb6631.js";import"./p-29d1ed0b.js";import{V as d}from"./p-415151d7.js";import{a as c,v as u,h as p}from"./p-b0ea4d0d.js";import{w as v}from"./p-38491ace.js";import{l as m}from"./p-bd8dee20.js";import{e as P,f as g,g as y,h as f}from"./p-0d34702b.js";import{M as b}from"./p-8b74fa0e.js";import{D as w}from"./p-874fa941.js";var C;!function(t){t.PiP="picture-in-picture",t.Inline="inline",t.Fullscreen="fullscreen"}(C||(C={}));const j=class{constructor(s){t(this,s),this.vLoadStart=i(this,"vLoadStart",7),this.disposal=new w,this.playbackStarted=!1,this.wasPausedBeforeSeeking=!0,this.willAttach=!1,this.preload="metadata",this.playbackRates=[.25,.5,.75,1,1.25,1.5,2],this.language="en",this.autoplay=!1,this.controls=!1,this.debug=!1,this.loop=!1,this.muted=!1,this.playsinline=!1}onMediaTitleChange(){this.dispatch(e.MediaTitle,this.mediaTitle)}onPosterChange(){this.dispatch(e.CurrentPoster,this.poster)}onViewTypeChange(){this.dispatch(e.ViewType,this.viewType)}componentWillLoad(){this.dispatch=r(this),this.onViewTypeChange(),this.onPosterChange(),this.onMediaTitleChange(),this.listenToTextTracksChanges(),this.vLoadStart.emit()}componentDidLoad(){this.onViewTypeChange()}disconnectedCallback(){this.mediaEl.pause(),this.cancelTimeUpdates(),this.disposal.empty(),this.playbackStarted=!1,this.wasPausedBeforeSeeking=!0}hasCustomPoster(){const t=l(this);return!h(t.querySelector("vime-ui vime-poster"))}cancelTimeUpdates(){n(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF),this.timeRAF=void 0}requestTimeUpdates(){var t,i;this.dispatch(e.CurrentTime,null!==(i=null===(t=this.mediaEl)||void 0===t?void 0:t.currentTime)&&void 0!==i?i:0),this.timeRAF=window.requestAnimationFrame(()=>{this.requestTimeUpdates()})}getMediaType(){const{currentSrc:t}=this.mediaEl;return c.test(t)?b.Audio:u.test(t)||p.test(t)?b.Video:void 0}onLoadedMetadata(){this.dispatch(e.CurrentPoster,this.poster),this.dispatch(e.Duration,this.mediaEl.duration),this.dispatch(e.PlaybackRates,this.playbackRates),this.onProgress(),this.onTracksChange(),this.willAttach||(this.dispatch(e.CurrentSrc,this.mediaEl.currentSrc),this.dispatch(e.MediaType,this.getMediaType()),this.dispatch(e.PlaybackReady,!0))}onProgress(){const{buffered:t,duration:i}=this.mediaEl,s=0===t.length?0:t.end(t.length-1);this.dispatch(e.Buffered,s>i?i:s)}onPlay(){this.requestTimeUpdates(),this.dispatch(e.Paused,!1),this.playbackStarted||(this.playbackStarted=!0,this.dispatch(e.PlaybackStarted,!0))}onPause(){this.cancelTimeUpdates(),this.dispatch(e.Paused,!0),this.dispatch(e.Buffering,!1)}onPlaying(){this.dispatch(e.Playing,!0),this.dispatch(e.Buffering,!1)}onSeeking(){this.wasPausedBeforeSeeking||(this.wasPausedBeforeSeeking=this.mediaEl.paused),this.dispatch(e.CurrentTime,this.mediaEl.currentTime),this.dispatch(e.Seeking,!0)}onSeeked(){this.dispatch(e.Seeking,!1),this.playbackStarted&&this.wasPausedBeforeSeeking||this.attemptToPlay(),this.wasPausedBeforeSeeking=!0}onRateChange(){this.dispatch(e.PlaybackRate,this.mediaEl.playbackRate)}onVolumeChange(){this.dispatch(e.Muted,this.mediaEl.muted),this.dispatch(e.Volume,100*this.mediaEl.volume)}onDurationChange(){this.dispatch(e.Duration,this.mediaEl.duration)}onWaiting(){this.dispatch(e.Buffering,!0)}onSuspend(){this.dispatch(e.Buffering,!1)}onEnded(){this.loop||this.dispatch(e.PlaybackEnded,!0)}onError(t){this.dispatch(e.Errors,[t])}attemptToPlay(){var t;try{null===(t=this.mediaEl)||void 0===t||t.play()}catch(t){this.dispatch(e.Errors,[t])}}togglePiPInChrome(t){var i;return t?null===(i=this.mediaEl)||void 0===i?void 0:i.requestPictureInPicture():document.exitPictureInPicture()}togglePiPInSafari(t){var i,s;const e=t?C.PiP:C.Inline;if(!(null===(i=this.mediaEl)||void 0===i?void 0:i.webkitSupportsPresentationMode(e)))throw new Error("PiP API is not available.");return null===(s=this.mediaEl)||void 0===s?void 0:s.webkitSetPresentationMode(e)}async togglePiP(t){if(P())return this.togglePiPInChrome(t);if(g())return this.togglePiPInSafari(t);throw new Error("PiP API is not available.")}async toggleFullscreen(t){var i,s,e;if(!(null===(i=this.mediaEl)||void 0===i?void 0:i.webkitSupportsFullscreen))throw new Error("Fullscreen API is not available.");return t?null===(s=this.mediaEl)||void 0===s?void 0:s.webkitEnterFullscreen():null===(e=this.mediaEl)||void 0===e?void 0:e.webkitExitFullscreen()}onPresentationModeChange(){var t;const i=null===(t=this.mediaEl)||void 0===t?void 0:t.webkitPresentationMode;this.dispatch(e.IsPiPActive,i===C.PiP),this.dispatch(e.IsFullscreenActive,i===C.Fullscreen)}onEnterPiP(){this.dispatch(e.IsPiPActive,!0)}onLeavePiP(){this.dispatch(e.IsPiPActive,!1)}onTracksChange(){this.dispatch(e.TextTracks,this.mediaEl.textTracks)}listenToTextTracksChanges(){o(this.mediaEl)||this.disposal.add(m(this.mediaEl.textTracks,"change",this.onTracksChange.bind(this)))}async getAdapter(){return{getInternalPlayer:async()=>this.mediaEl,play:async()=>{var t;return null===(t=this.mediaEl)||void 0===t?void 0:t.play()},pause:async()=>{var t;return null===(t=this.mediaEl)||void 0===t?void 0:t.pause()},canPlay:async t=>a(t)&&(c.test(t)||u.test(t)),setCurrentTime:async t=>{this.mediaEl&&(this.mediaEl.currentTime=t)},setMuted:async t=>{this.mediaEl&&(this.mediaEl.muted=t)},setVolume:async t=>{this.mediaEl&&(this.mediaEl.volume=t/100)},canSetPlaybackRate:async()=>!0,setPlaybackRate:async t=>{this.mediaEl&&(this.mediaEl.playbackRate=t)},canSetPiP:async()=>y(),enterPiP:()=>this.togglePiP(!0),exitPiP:()=>this.togglePiP(!1),canSetFullscreen:async()=>f(),enterFullscreen:()=>this.toggleFullscreen(!0),exitFullscreen:()=>this.toggleFullscreen(!1)}}render(){const t={autoplay:this.autoplay,muted:this.muted,playsinline:this.playsinline,playsInline:this.playsinline,"x5-playsinline":this.playsinline,"webkit-playsinline":this.playsinline,controls:this.controls,crossorigin:this.crossOrigin,controlslist:this.controlsList,"data-poster":this.hasCustomPoster()?void 0:this.poster,loop:this.loop,preload:this.preload,disablePictureInPicture:this.disablePiP,autoPictureInPicture:this.autoPiP,disableRemotePlayback:this.disableRemotePlayback,"x-webkit-airplay":this.disableRemotePlayback?"deny":"allow",ref:t=>{this.mediaEl=t},onLoadedMetadata:this.onLoadedMetadata.bind(this),onProgress:this.onProgress.bind(this),onPlay:this.onPlay.bind(this),onPause:this.onPause.bind(this),onPlaying:this.onPlaying.bind(this),onSeeking:this.onSeeking.bind(this),onSeeked:this.onSeeked.bind(this),onRateChange:this.onRateChange.bind(this),onVolumeChange:this.onVolumeChange.bind(this),onDurationChange:this.onDurationChange.bind(this),onWaiting:this.onWaiting.bind(this),onSuspend:this.onSuspend.bind(this),onEnded:this.onEnded.bind(this),onError:this.onError.bind(this)},i=s("audio",Object.assign({class:"lazy"},t),s("slot",null),"Your browser does not support the",s("code",null,"audio"),"element."),e=s("video",Object.assign({class:"lazy"},t,{onwebkitpresentationmodechanged:this.onPresentationModeChange.bind(this),onenterpictureinpicture:this.onEnterPiP.bind(this),onleavepictureinpicture:this.onLeavePiP.bind(this)}),s("slot",null),"Your browser does not support the",s("code",null,"video"),"element.");return this.viewType===d.Audio?i:e}static get watchers(){return{mediaTitle:["onMediaTitleChange"],poster:["onPosterChange"],viewType:["onViewTypeChange"]}}};v(j),j.style="vime-file audio,vime-file video{border-radius:inherit;vertical-align:middle;width:100%;outline:0}vime-file video{position:absolute;top:0;left:0;border:0;height:100%;user-select:none}";export{j as vime_file}