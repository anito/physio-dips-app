import{r as t,c as s,h as i}from"./p-6a8a5b8e.js";import{P as e}from"./p-7e342812.js";import{h,d as a,b as r}from"./p-d22fa63b.js";import{c as o}from"./p-1f4b6ee8.js";import"./p-0d94bd6e.js";import"./p-d8b735e7.js";import"./p-bd8dee20.js";import{V as n}from"./p-415151d7.js";import{M as c}from"./p-8b74fa0e.js";import"./p-cab62385.js";import{b as d}from"./p-03f3cfce.js";import{w as m}from"./p-e3411fb0.js";import{d as p}from"./p-baa4c165.js";var l,b,u;!function(t){t.Play="play",t.Pause="pause",t.SetMuted="setMuted",t.SetVolume="setVolume",t.GetDuration="getDuration",t.GetCurrentTime="getCurrentTime",t.SetCurrentTime="setCurrentTime",t.SetPlaybackRate="setPlaybackRate",t.AddEventListener="addEventListener",t.GetVideoTitle="getVideoTitle",t.GetTextTracks="getTextTracks",t.EnableTextTrack="enableTextTrack",t.DisableTextTrack="disableTextTrack"}(l||(l={})),function(t){t.Play="play",t.Pause="pause",t.Seeking="seeking",t.Seeked="seeked",t.TimeUpdate="timeupdate",t.VolumeChange="volumechange",t.DurationChange="durationchange",t.FullscreenChange="fullscreenchange",t.CueChange="cuechange",t.Progress="progress",t.Error="error",t.PlaybackRateChange="playbackratechange",t.Loaded="loaded",t.BufferStart="bufferstart",t.BufferEnd="bufferend",t.TextTrackChange="texttrackchange",t.Waiting="waiting",t.Ended="ended"}(b||(b={})),function(t){t.Play="play",t.Pause="pause",t.Ready="ready",t.PlayProgress="playProgress",t.LoadProgress="loadProgress",t.BufferStart="bufferstart",t.BufferEnd="bufferend",t.Loaded="loaded",t.Finish="finish",t.Seeking="seeking",t.Seeked="seek",t.CueChange="cuechange",t.FullscreenChange="fullscreenchange",t.VolumeChange="volumechange",t.DurationChange="durationchange",t.PlaybackRateChange="playbackratechange",t.TextTrackChange="texttrackchange",t.Error="error"}(u||(u={}));const v=class{constructor(i){t(this,i),this.vLoadStart=s(this,"vLoadStart",7),this.defaultInternalState={},this.volume=50,this.internalState={paused:!0,playing:!1,seeking:!1,currentTime:0,buffered:0,playbackStarted:!1,playRequest:!1},this.embedSrc="",this.mediaTitle="",this.byline=!0,this.portrait=!0,this.language="en",this.autoplay=!1,this.controls=!1,this.debug=!1,this.loop=!1,this.muted=!1,this.playsinline=!1}onVideoIdChange(){this.embedSrc=`${this.getOrigin()}/video/${this.videoId}`,this.cancelTimeUpdates(),this.pendingDurationFetch=p(),this.pendingMediaTitleFetch=p(),this.pendingPosterFetch=this.findPosterURL()}componentWillLoad(){this.dispatch=o(this),this.dispatch(e.viewType,n.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.defaultInternalState=Object.assign({},this.internalState)}disconnectedCallback(){this.cancelTimeUpdates(),this.pendingPlayRequest=void 0,this.pendingPosterFetch=void 0,this.pendingDurationFetch=void 0,this.pendingMediaTitleFetch=void 0}getOrigin(){return"https://player.vimeo.com"}getPreconnections(){return[this.getOrigin(),"https://i.vimeocdn.com","https://f.vimeocdn.com","https://fresnel.vimeocdn.com"]}remoteControl(t,s){return this.embed.postMessage({method:t,value:s})}buildParams(){return{byline:this.byline,color:this.color,portrait:this.portrait,autopause:!1,transparent:!1,autoplay:this.autoplay,muted:this.initialMuted,playsinline:this.playsinline}}findPosterURL(){return window.fetch("https://vimeo.com/api/oembed.json?url="+this.embedSrc).then(t=>t.json()).then(t=>{const s=t.thumbnail_url.match(/vimeocdn\.com\/video\/([0-9]+)/)[1];this.dispatch(e.currentPoster,`https://i.vimeocdn.com/video/${s}_1920x1080.jpg`)})}onTimeChange(t){this.internalState.currentTime!==t&&(this.dispatch(e.currentTime,t),Math.abs(this.internalState.currentTime-t)>1.5&&(this.internalState.seeking=!0,this.dispatch(e.seeking,!0),this.internalState.playing&&this.internalState.buffered<t&&this.dispatch(e.buffering,!0),window.clearTimeout(this.pendingPlayRequest),this.internalState.paused||(this.internalState.playRequest=!0),this.remoteControl(this.internalState.playbackStarted?l.Pause:l.Play)),this.internalState.currentTime=t)}cancelTimeUpdates(){h(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF)}requestTimeUpdates(){this.remoteControl(l.GetCurrentTime),this.timeRAF=window.requestAnimationFrame(()=>{this.requestTimeUpdates()})}onSeeked(){this.internalState.seeking&&(this.dispatch(e.seeking,!1),this.internalState.seeking=!1,this.internalState.playRequest&&window.setTimeout(()=>{this.remoteControl(l.Play)},150))}onVimeoMethod(t,s){var i,h;switch(t){case l.GetCurrentTime:this.internalState.seeking||this.onTimeChange(s);break;case l.GetDuration:this.dispatch(e.duration,s),null===(i=this.pendingDurationFetch)||void 0===i||i.resolve();break;case l.GetVideoTitle:this.dispatch(e.mediaTitle,s),null===(h=this.pendingMediaTitleFetch)||void 0===h||h.resolve()}}onVimeoEvent(t,s){var i,h;switch(t){case u.Ready:Object.values(b).forEach(t=>{this.remoteControl(l.AddEventListener,t)});break;case u.Loaded:this.pendingPlayRequest=void 0,this.internalState=Object.assign({},this.defaultInternalState),this.dispatch(e.currentSrc,this.embedSrc),this.dispatch(e.mediaType,c.Video),this.remoteControl(l.GetDuration),this.remoteControl(l.GetVideoTitle),Promise.all([this.pendingPosterFetch,null===(i=this.pendingDurationFetch)||void 0===i?void 0:i.promise,null===(h=this.pendingMediaTitleFetch)||void 0===h?void 0:h.promise]).then(()=>{this.requestTimeUpdates(),this.dispatch(e.playbackReady,!0)});break;case u.Play:this.internalState.paused=!1,this.dispatch(e.paused,!1);break;case u.PlayProgress:this.internalState.playing||(this.dispatch(e.playing,!0),this.internalState.playing=!0,this.internalState.playbackStarted=!0,this.pendingPlayRequest=window.setTimeout(()=>{this.internalState.playRequest=!1,this.pendingPlayRequest=void 0},1e3)),this.dispatch(e.buffering,!1),this.onSeeked();break;case u.Pause:this.internalState.paused=!0,this.internalState.playing=!1,this.dispatch(e.paused,!0),this.dispatch(e.buffering,!1);break;case u.LoadProgress:this.internalState.buffered=s.seconds,this.dispatch(e.buffered,s.seconds);break;case u.BufferStart:this.dispatch(e.buffering,!0),this.internalState.paused&&(this.internalState.paused=!1,this.dispatch(e.paused,!1),this.dispatch(e.playbackStarted,!0));break;case u.BufferEnd:this.dispatch(e.buffering,!1),this.internalState.paused&&this.onSeeked();break;case u.VolumeChange:s.volume>0?(this.volume=s.volume,this.dispatch(e.muted,!1),this.dispatch(e.volume,Math.floor(100*this.volume))):this.dispatch(e.muted,!0);break;case u.DurationChange:this.dispatch(e.duration,s.duration);break;case u.PlaybackRateChange:this.dispatch(e.playbackRate,s.playbackRate);break;case u.FullscreenChange:this.dispatch(e.isFullscreenActive,s.fullscreen);break;case u.Finish:this.loop?(this.remoteControl(l.SetCurrentTime,0),setTimeout(()=>{this.remoteControl(l.Play)},200)):this.dispatch(e.playbackEnded,!0);break;case u.Error:this.dispatch(e.errors,[new Error(s)])}}onEmbedSrcChange(){this.vLoadStart.emit()}onEmbedMessage(t){const s=t.detail;a(s.event)||this.onVimeoEvent(s.event,s.data),a(s.method)||this.onVimeoMethod(s.method,s.value)}async getAdapter(){const t=/vimeo(?:\.com|)\/([0-9]{9,})/,s=/vimeo\.com\/external\/[0-9]+\..+/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl(l.Play)},pause:async()=>{this.remoteControl(l.Pause)},canPlay:async i=>r(i)&&!s.test(i)&&t.test(i),setCurrentTime:async t=>{this.remoteControl(l.SetCurrentTime,t)},setMuted:async t=>{this.remoteControl(l.SetVolume,t?0:this.volume)},setVolume:async t=>{this.volume=t/100,this.muted?this.dispatch(e.volume,t):this.remoteControl(l.SetVolume,this.volume)},canSetPlaybackRate:async()=>!1,setPlaybackRate:async t=>{this.remoteControl(l.SetPlaybackRate,t)}}}render(){return i("vime-embed",{class:{hideControls:!this.controls},embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:d,preconnections:this.getPreconnections(),onVEmbedMessage:this.onEmbedMessage.bind(this),onVEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{videoId:["onVideoIdChange"]}}};m(v),v.style="vime-vimeo>vime-embed.hideControls{display:block;width:100%;position:relative;padding-bottom:200%;transform:translateY(-35.95%);z-index:0}";export{v as vime_vimeo}