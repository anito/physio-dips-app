import{r as t,c as s,h as i}from"./p-7d485867.js";import{P as e}from"./p-d8000c6e.js";import{h,e as a,a as r}from"./p-eef3d203.js";import{c as o}from"./p-59c69388.js";import{d as n}from"./p-e9fb6631.js";import"./p-29d1ed0b.js";import{V as c}from"./p-415151d7.js";import{w as d}from"./p-38491ace.js";import"./p-bd8dee20.js";import"./p-0d34702b.js";import{a as m}from"./p-64e9395d.js";import{M as p}from"./p-8b74fa0e.js";var l,u,b;!function(t){t.Play="play",t.Pause="pause",t.SetMuted="setMuted",t.SetVolume="setVolume",t.GetDuration="getDuration",t.GetCurrentTime="getCurrentTime",t.SetCurrentTime="setCurrentTime",t.SetPlaybackRate="setPlaybackRate",t.AddEventListener="addEventListener",t.GetVideoTitle="getVideoTitle",t.GetTextTracks="getTextTracks",t.EnableTextTrack="enableTextTrack",t.DisableTextTrack="disableTextTrack"}(l||(l={})),function(t){t.Play="play",t.Pause="pause",t.Seeking="seeking",t.Seeked="seeked",t.TimeUpdate="timeupdate",t.VolumeChange="volumechange",t.DurationChange="durationchange",t.FullscreenChange="fullscreenchange",t.CueChange="cuechange",t.Progress="progress",t.Error="error",t.PlaybackRateChange="playbackratechange",t.Loaded="loaded",t.BufferStart="bufferstart",t.BufferEnd="bufferend",t.TextTrackChange="texttrackchange",t.Waiting="waiting",t.Ended="ended"}(u||(u={})),function(t){t.Play="play",t.Pause="pause",t.Ready="ready",t.PlayProgress="playProgress",t.LoadProgress="loadProgress",t.BufferStart="bufferstart",t.BufferEnd="bufferend",t.Loaded="loaded",t.Finish="finish",t.Seeking="seeking",t.Seeked="seek",t.CueChange="cuechange",t.FullscreenChange="fullscreenchange",t.VolumeChange="volumechange",t.DurationChange="durationchange",t.PlaybackRateChange="playbackratechange",t.TextTrackChange="texttrackchange",t.Error="error"}(b||(b={}));const v=class{constructor(i){t(this,i),this.vLoadStart=s(this,"vLoadStart",7),this.defaultInternalState={},this.volume=50,this.internalState={paused:!0,playing:!1,seeking:!1,currentTime:0,buffered:0,playbackStarted:!1,playRequest:!1},this.embedSrc="",this.mediaTitle="",this.byline=!0,this.portrait=!0,this.language="en",this.autoplay=!1,this.controls=!1,this.debug=!1,this.loop=!1,this.muted=!1,this.playsinline=!1}onVideoIdChange(){this.embedSrc=`${this.getOrigin()}/video/${this.videoId}`,this.cancelTimeUpdates(),this.pendingDurationFetch=n(),this.pendingMediaTitleFetch=n(),this.pendingPosterFetch=this.findPosterURL()}componentWillLoad(){this.dispatch=o(this),this.dispatch(e.ViewType,c.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.defaultInternalState=Object.assign({},this.internalState)}disconnectedCallback(){this.cancelTimeUpdates(),this.pendingPlayRequest=void 0,this.pendingPosterFetch=void 0,this.pendingDurationFetch=void 0,this.pendingMediaTitleFetch=void 0}getOrigin(){return"https://player.vimeo.com"}getPreconnections(){return[this.getOrigin(),"https://i.vimeocdn.com","https://f.vimeocdn.com","https://fresnel.vimeocdn.com"]}remoteControl(t,s){return this.embed.postMessage({method:t,value:s})}buildParams(){return{byline:this.byline,color:this.color,portrait:this.portrait,autopause:!1,transparent:!1,autoplay:this.autoplay,muted:this.initialMuted,playsinline:this.playsinline}}findPosterURL(){return window.fetch("https://vimeo.com/api/oembed.json?url="+this.embedSrc).then(t=>t.json()).then(t=>{const s=t.thumbnail_url.match(/vimeocdn\.com\/video\/([0-9]+)/)[1];this.dispatch(e.CurrentPoster,`https://i.vimeocdn.com/video/${s}_1920x1080.jpg`)})}onTimeChange(t){this.internalState.currentTime!==t&&(this.dispatch(e.CurrentTime,t),Math.abs(this.internalState.currentTime-t)>1.5&&(this.internalState.seeking=!0,this.dispatch(e.Seeking,!0),this.internalState.playing&&this.internalState.buffered<t&&this.dispatch(e.Buffering,!0),window.clearTimeout(this.pendingPlayRequest),this.internalState.paused||(this.internalState.playRequest=!0),this.remoteControl(this.internalState.playbackStarted?l.Pause:l.Play)),this.internalState.currentTime=t)}cancelTimeUpdates(){h(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF)}requestTimeUpdates(){this.remoteControl(l.GetCurrentTime),this.timeRAF=window.requestAnimationFrame(()=>{this.requestTimeUpdates()})}onSeeked(){this.internalState.seeking&&(this.dispatch(e.Seeking,!1),this.internalState.seeking=!1,this.internalState.playRequest&&window.setTimeout(()=>{this.remoteControl(l.Play)},150))}onVimeoMethod(t,s){var i,h;switch(t){case l.GetCurrentTime:this.internalState.seeking||this.onTimeChange(s);break;case l.GetDuration:this.dispatch(e.Duration,s),null===(i=this.pendingDurationFetch)||void 0===i||i.resolve();break;case l.GetVideoTitle:this.dispatch(e.MediaTitle,s),null===(h=this.pendingMediaTitleFetch)||void 0===h||h.resolve()}}onVimeoEvent(t,s){var i,h;switch(t){case b.Ready:Object.values(u).forEach(t=>{this.remoteControl(l.AddEventListener,t)});break;case b.Loaded:this.pendingPlayRequest=void 0,this.internalState=Object.assign({},this.defaultInternalState),this.dispatch(e.CurrentSrc,this.embedSrc),this.dispatch(e.MediaType,p.Video),this.remoteControl(l.GetDuration),this.remoteControl(l.GetVideoTitle),Promise.all([this.pendingPosterFetch,null===(i=this.pendingDurationFetch)||void 0===i?void 0:i.promise,null===(h=this.pendingMediaTitleFetch)||void 0===h?void 0:h.promise]).then(()=>{this.requestTimeUpdates(),this.dispatch(e.PlaybackReady,!0)});break;case b.Play:this.internalState.paused=!1,this.dispatch(e.Paused,!1);break;case b.PlayProgress:this.internalState.playing||(this.dispatch(e.Playing,!0),this.internalState.playing=!0,this.internalState.playbackStarted=!0,this.pendingPlayRequest=window.setTimeout(()=>{this.internalState.playRequest=!1,this.pendingPlayRequest=void 0},1e3)),this.dispatch(e.Buffering,!1),this.onSeeked();break;case b.Pause:this.internalState.paused=!0,this.internalState.playing=!1,this.dispatch(e.Paused,!0),this.dispatch(e.Buffering,!1);break;case b.LoadProgress:this.internalState.buffered=s.seconds,this.dispatch(e.Buffered,s.seconds);break;case b.BufferStart:this.dispatch(e.Buffering,!0),this.internalState.paused&&(this.internalState.paused=!1,this.dispatch(e.Paused,!1),this.dispatch(e.PlaybackStarted,!0));break;case b.BufferEnd:this.dispatch(e.Buffering,!1),this.internalState.paused&&this.onSeeked();break;case b.VolumeChange:s.volume>0?(this.volume=s.volume,this.dispatch(e.Muted,!1),this.dispatch(e.Volume,Math.floor(100*this.volume))):this.dispatch(e.Muted,!0);break;case b.DurationChange:this.dispatch(e.Duration,s.duration);break;case b.PlaybackRateChange:this.dispatch(e.PlaybackRate,s.playbackRate);break;case b.FullscreenChange:this.dispatch(e.IsFullscreenActive,s.fullscreen);break;case b.Finish:this.loop?(this.remoteControl(l.SetCurrentTime,0),setTimeout(()=>{this.remoteControl(l.Play)},200)):this.dispatch(e.PlaybackEnded,!0);break;case b.Error:this.dispatch(e.Errors,[new Error(s)])}}onEmbedSrcChange(){this.vLoadStart.emit()}onEmbedMessage(t){const s=t.detail;a(s.event)||this.onVimeoEvent(s.event,s.data),a(s.method)||this.onVimeoMethod(s.method,s.value)}async getAdapter(){const t=/vimeo(?:\.com|)\/([0-9]{9,})/,s=/vimeo\.com\/external\/[0-9]+\..+/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl(l.Play)},pause:async()=>{this.remoteControl(l.Pause)},canPlay:async i=>r(i)&&!s.test(i)&&t.test(i),setCurrentTime:async t=>{this.remoteControl(l.SetCurrentTime,t)},setMuted:async t=>{this.remoteControl(l.SetVolume,t?0:this.volume)},setVolume:async t=>{this.volume=t/100,this.muted?this.dispatch(e.Volume,t):this.remoteControl(l.SetVolume,this.volume)},canSetPlaybackRate:async()=>!1,setPlaybackRate:async t=>{this.remoteControl(l.SetPlaybackRate,t)}}}render(){return i("vime-embed",{class:{hideControls:!this.controls},embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:m,preconnections:this.getPreconnections(),onVEmbedMessage:this.onEmbedMessage.bind(this),onVEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{videoId:["onVideoIdChange"]}}};d(v),v.style="vime-vimeo>vime-embed.hideControls{display:block;width:100%;position:relative;padding-bottom:200%;transform:translateY(-35.95%);z-index:0}";export{v as vime_vimeo}