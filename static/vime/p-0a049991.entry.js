import{r as t,c as s,h as i}from"./p-7d485867.js";import{P as e}from"./p-d8000c6e.js";import{a}from"./p-eef3d203.js";import{c as h}from"./p-59c69388.js";import{d as r}from"./p-e9fb6631.js";import"./p-29d1ed0b.js";import{V as o}from"./p-415151d7.js";import{w as n}from"./p-38491ace.js";import"./p-bd8dee20.js";import"./p-0d34702b.js";import{d as c}from"./p-64e9395d.js";import{M as d}from"./p-8b74fa0e.js";var l,m;!function(t){t.Play="play",t.Pause="pause",t.Seek="seek",t.Volume="volume",t.Controls="controls",t.Muted="muted",t.Quality="quality",t.Fullscreen="fullscreen"}(l||(l={})),function(t){t.ApiReady="apiready",t.VideoChange="videochange",t.VolumeChange="volumechange",t.PlaybackReady="playback_ready",t.Seeking="seeking",t.Seeked="seeked",t.Waiting="waiting",t.Progress="progress",t.QualityChange="qualitychange",t.QualitiesAvailable="qualitiesavailable",t.FullscreenChange="fullscreenchange",t.DurationChange="durationchange",t.ControlsChange="controlschange",t.Playing="playing",t.Play="play",t.Pause="pause",t.Start="start",t.AdStart="ad_start",t.AdPlay="ad_play",t.AdEnd="ad_end",t.TimeUpdate="timeupdate",t.VideoStart="video_start",t.VideoEnd="video_end",t.Error="error"}(m||(m={}));const p=class{constructor(i){t(this,i),this.vLoadStart=s(this,"vLoadStart",7),this.defaultInternalState={},this.internalState={currentTime:0,volume:0,muted:!1,isAdsPlaying:!1,playbackReady:!1},this.embedSrc="",this.mediaTitle="",this.shouldAutoplayQueue=!1,this.showUpNextQueue=!1,this.showShareButtons=!1,this.showDailymotionLogo=!1,this.showVideoInfo=!0,this.language="en",this.autoplay=!1,this.controls=!1,this.debug=!1,this.loop=!1,this.muted=!1,this.playsinline=!1}onVideoIdChange(){this.embedSrc=`${this.getOrigin()}/embed/video/${this.videoId}?api=1`,this.internalState=Object.assign({},this.defaultInternalState),this.pendingVideoInfoFetch=this.fetchVideoInfo(),this.pendingMediaTitleFetch=r()}onControlsChange(){this.internalState.playbackReady&&this.remoteControl(l.Controls,this.controls)}componentWillLoad(){this.dispatch=h(this),this.dispatch(e.ViewType,o.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.internalState.muted=this.muted,this.defaultInternalState=Object.assign({},this.internalState)}disconnectedCallback(){this.pendingVideoInfoFetch=void 0,this.pendingMediaTitleFetch=void 0}getOrigin(){return"https://www.dailymotion.com"}getPreconnections(){return[this.getOrigin(),"https://static1.dmcdn.net"]}remoteControl(t,s){return this.embed.postMessage({command:t,parameters:s?[s]:[]})}buildParams(){return{autoplay:this.autoplay,mute:this.initialMuted,"queue-autoplay-next":this.shouldAutoplayQueue,"queue-enable":this.showUpNextQueue,"sharing-enable":this.showShareButtons,syndication:this.syndication,"ui-highlight":this.color,"ui-logo":this.showDailymotionLogo,"ui-start-screen-info":this.showVideoInfo}}fetchVideoInfo(){return window.fetch(`https://api.dailymotion.com/video/${this.videoId}?fields=duration,thumbnail_1080_url`).then(t=>t.json()).then(t=>{this.dispatch(e.CurrentPoster,t.thumbnail_1080_url),this.dispatch(e.Duration,parseFloat(t.duration))})}onEmbedSrcChange(){this.vLoadStart.emit()}onEmbedMessage(t){var s,i;const a=t.detail;switch(a.event){case m.PlaybackReady:this.onControlsChange(),this.dispatch(e.CurrentSrc,this.embedSrc),this.dispatch(e.MediaType,d.Video),Promise.all([this.pendingVideoInfoFetch,null===(s=this.pendingMediaTitleFetch)||void 0===s?void 0:s.promise]).then(()=>{this.dispatch(e.PlaybackReady,!0)});break;case m.VideoChange:this.dispatch(e.MediaTitle,a.title),null===(i=this.pendingMediaTitleFetch)||void 0===i||i.resolve();break;case m.Start:this.dispatch(e.Paused,!1),this.dispatch(e.PlaybackStarted,!0),this.dispatch(e.Buffering,!0);break;case m.VideoStart:this.remoteControl(l.Muted,this.internalState.muted),this.remoteControl(l.Volume,this.internalState.volume),this.internalState.currentTime>0&&this.remoteControl(l.Seek,this.internalState.currentTime);break;case m.Play:this.dispatch(e.Paused,!1);break;case m.Pause:this.dispatch(e.Paused,!0),this.dispatch(e.Playing,!1),this.dispatch(e.Buffering,!1);break;case m.Playing:this.dispatch(e.Playing,!0),this.dispatch(e.Buffering,!1);break;case m.VideoEnd:this.loop?setTimeout(()=>{this.remoteControl(l.Play)},300):this.dispatch(e.PlaybackEnded,!0);break;case m.TimeUpdate:this.dispatch(e.CurrentTime,parseFloat(a.time));break;case m.VolumeChange:this.dispatch(e.Muted,"true"===a.muted),this.dispatch(e.Volume,Math.floor(100*parseFloat(a.volume)));break;case m.Seeking:this.dispatch(e.CurrentTime,parseFloat(a.time)),this.dispatch(e.Seeking,!0);break;case m.Seeked:this.dispatch(e.CurrentTime,parseFloat(a.time)),this.dispatch(e.Seeking,!1);break;case m.Waiting:this.dispatch(e.Buffering,!0);break;case m.Progress:this.dispatch(e.Buffered,parseFloat(a.time));break;case m.DurationChange:this.dispatch(e.Duration,parseFloat(a.duration));break;case m.QualitiesAvailable:this.dispatch(e.PlaybackQualities,a.qualities.map(t=>t+"p"));break;case m.QualityChange:this.dispatch(e.PlaybackQuality,a.quality+"p");break;case m.FullscreenChange:this.dispatch(e.IsFullscreenActive,"true"===a.fullscreen);break;case m.Error:this.dispatch(e.Errors,[new Error(a.error)])}}async getAdapter(){const t=/(?:dai\.ly|dailymotion|dailymotion\.com)\/(?:video\/|embed\/|)(?:video\/|)((?:\w)+)/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl(l.Play)},pause:async()=>{this.remoteControl(l.Pause)},canPlay:async s=>a(s)&&t.test(s),setCurrentTime:async t=>{this.internalState.currentTime=t,this.remoteControl(l.Seek,t)},setMuted:async t=>{this.internalState.muted=t,this.remoteControl(l.Muted,t)},setVolume:async t=>{this.internalState.volume=t/100,this.dispatch(e.Volume,t),this.remoteControl(l.Volume,t/100)},canSetPlaybackQuality:async()=>!0,setPlaybackQuality:async t=>{this.remoteControl(l.Quality,t.slice(0,-1))},canSetFullscreen:async()=>!0,enterFullscreen:async()=>{this.remoteControl(l.Fullscreen,!0)},exitFullscreen:async()=>{this.remoteControl(l.Fullscreen,!1)}}}render(){return i("vime-embed",{embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:c,preconnections:this.getPreconnections(),onVEmbedMessage:this.onEmbedMessage.bind(this),onVEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{videoId:["onVideoIdChange"],controls:["onControlsChange"]}}};n(p);export{p as vime_dailymotion}