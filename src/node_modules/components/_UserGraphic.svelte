<script>
  import { stores } from "@sapper/app";
  import { Graphic } from "@smui/list";
  import { getMedia } from "utils";

  export let user;
  export let dense = "";
  export let width = 24;
  export let height = 24;

  const { session } = stores();
  const placeholder = `https://via.placeholder.com/${width}x${height}.png?text=`;

  let src;

  $: (async (usr) => {
    let res,
      avatar = usr.avatar;

    src = usr ? `${placeholder}${defaultAvatar(usr)}` : placeholder;

    if (avatar) {
      res = await getMedia("AVATAR", avatar.id, $session.user, {
        width,
        height,
        square: 1,
      });
      if (res) src = res;
    }
  })(user);

  function defaultAvatar(user) {
    let name = user.name || "?";
    return `${placeholder}${name
      .split(" ")
      .map((val) => val.substring(0, 1))
      .join("")}`;
  }
</script>

<style>
  .user-graphics-outer {
    display: inline-block;
  }
  .user-graphics-outer :global(.user-graphics) {
    border-radius: 50%;
  }
  .user-graphics-outer.dense :global(.user-graphics) {
    margin-right: 0;
  }
</style>

<div class="user-graphics-outer" class:dense>
  <Graphic
    class="user-graphics"
    style="background-image: url({src}); display: inline-flex; vertical-align: middle; width: {width}px; height: {height}px;" />
</div>
