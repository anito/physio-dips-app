<script>
  import { stores } from "@sapper/app";
  import { Graphic } from "@smui/list";
  import { getMedia } from "utils";

  export let user;

  let src = "";

  const { session } = stores();
  const placeholder = "https://via.placeholder.com/40x40.png?text=";

  $: (async (usr) => {
    let res,
      avatar = usr.avatar;

    if (avatar) {
      res = await getMedia("AVATAR", avatar.id, $session.user, {
        width: 40,
        height: 40,
        square: 1,
      });
      if (res) src = res;
    } else src = defaultAvatar(user);
  })(user);

  function defaultAvatar(user) {
    let name = user.name || "?";
    return `${placeholder}${name
      .split(" ")
      .map((val) => val.substring(0, 1))
      .join("")}`;
  }
</script>

<Graphic style="background-image: url({src});" />
