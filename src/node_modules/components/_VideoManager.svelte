<script>
  import { stores, goto } from "@sapper/app";
  import { getContext, onMount } from "svelte";
  import { fly } from "svelte/transition";
  import Paper, { Title, Subtitle, Content } from "@smui/paper";
  import Fab, { Label, Icon } from "@smui/fab";
  import VideoUploader from "./_VideoUploader.svelte";
  import VideoCard from "./_VideoCard.svelte";
  import Info from "./_Info.svelte";
  import { videos } from "../../stores/videoStore";
  import { images } from "../../stores/imageStore";
  import { currentVideo } from "../../stores/currentVideoStore";

  const { session } = stores();
  const { open } = getContext("simple-modal");

  let user = $session.user;

  let openUploader = () => {
    open(
      VideoUploader,
      {},
      {
        transitionWindow: fly,
        transitionWindowProps: {
          y: -200,
          duration: 500,
        },
      }
    );
  };

  function setCurrentVideo(e) {
    currentVideo.set(e.detail);
  }
</script>

<div class="lg:m-8">
  {#if user}
    {#if $videos.length}
      <div class="flex flex-wrap flex-row lg:justify-start justify-center">
        {#each $videos as video (video.id)}
          <div class="flex mx-1 my-2">
            <div>
              <VideoCard on:Video:current={setCurrentVideo} {video} {images} />
            </div>
          </div>
        {/each}
      </div>
    {:else}
      <div class="paper-container flex justify-center">
        <Paper color="primary" class="paper-demo">
          <Title style="color: var(--text-light)">No Videos available</Title>
          {#if $session.role === 'Administrator'}
            <Content>
              <a
                href="/videos"
                on:click|preventDefault={openUploader}>Upload</a>
              some videos to your content
            </Content>
          {/if}
        </Paper>
      </div>
    {/if}
    {#if $session.role === 'Administrator'}
      <Fab
        class="floating-fab"
        color="primary"
        on:click={openUploader}
        extended>
        <Label>Add Video</Label>
        <Icon class="material-icons">add</Icon>
      </Fab>
    {/if}
  {:else}
    <div class="paper-container flex justify-center m-8">
      <Info title="Unauthorized" let:href>
        <a {href} on:click|preventDefault={() => goto(href)}>Login</a>
      </Info>
    </div>
  {/if}
</div>
